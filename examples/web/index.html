<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
  </head>
  <body
    style="text-align: center; margin-top: 50px; font-family: Arial, sans-serif"
  >
    <h1>FastText Classification Demo</h1>
    <input
      id="text"
      name="text"
      style="
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: transparent;
        margin-inline: auto;
        inline-size: 220px;
        block-size: 30px;
        margin-inline: 15px;
      "
    />
    <button
      id="sendButton"
      disabled
      style="
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
      "
    >
      Loading...
    </button>
    <!-- result -->
    <div>
      <textarea
        id="result"
        style="
          margin-top: 20px;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 5px;
          background-color: #f9f9f9;
          inline-size: 300px;
          block-size: 200px;
          margin-inline: auto;
          text-align: center;
        "
      >
      </textarea>
    </div>
    <script type="module">
      const button = document.querySelector("#sendButton");
      const klassify = new Worker("../../dist/klassify.worker.js", {
        type: "module",
      });

      klassify.postMessage({
        action: "init",
        payload: {
          config: {
            models: {
              // demo_fa_ft: "../../models/trained/demo-persian.ftz",
              // demo_en_ft: "../../models/trained/demo-english.ftz",
              // demo_en_ca: {
              //   baseURL:
              //     "https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2/resolve/main/",
              //   labels: ["Fullname", "Mobile Number", "Address", "Work"],
              // },
              demo_xx_ca: {
                baseURL:
                  "https://huggingface.co/intfloat/multilingual-e5-small/resolve/main/",
                searchPrefix: "query: ",
                documentPrefix: "passage: ",
              },
            },
            labels: {
              "نام و نام خانوادگی": 1,
              "تلفن همراه": 2,
              "محل سکونت": 3,
              کار: 4,
            },
            preload: true,
          },
        },
      });

      klassify.onmessage = (e) => {
        if (e.data.result) {
          console.log("Classification result:", e.data.result);
          const resultElement = document.querySelector("#result");
          resultElement.value = e.data?.result?.label;
        } else {
          console.log("Worker message:", e.data);
        }

        if (e.data.status && e.data.status === "READY") {
          button.removeAttribute("disabled");
          button.textContent = "Send";
          button.style.cursor = "pointer";
          button.addEventListener("click", interferenceHandler);
        }
      };

      function interferenceHandler() {
        const text = document.querySelector("#text").value;
        console.log(text);
        klassify.postMessage({
          action: "classify",
          payload: {
            text,
            modelId: "demo",
          },
        });
      }
    </script>
  </body>
</html>
